holygpu8a11103:0 err: [W socket.cpp:464] [c10d] The server socket cannot be initialized on [::]:39797 (errno: 97 - Address family not supported by protocol).
holygpu8a11103:0 err: [W socket.cpp:697] [c10d] The client socket cannot be initialized to connect to [holygpu8a11103.rc.fas.harvard.edu]:39797 (errno: 97 - Address family not supported by protocol).
holygpu8a11103:0 out: 2024-11-14 21:05:33.966	holygpu8a11103.rc.fas.harvard.edu:0	train:330	INFO	multiprocessing start method set to 'spawn'
holygpu8a11103:0 out: 2024-11-14 21:05:36.434	holygpu8a11103.rc.fas.harvard.edu:0	train:161	INFO	Configuration:
holygpu8a11103:0 out: 2024-11-14 21:05:36.434	holygpu8a11103.rc.fas.harvard.edu:0	train:162	INFO	TrainConfig(just_score_model=True, tau=None, data_start_step=0, sft_dataset=None, load_checkpoint_type='unsharded', run_name='olmo_57680871_1', seed=1, epoch=None, dry_run=False, model=ModelConfig(d_model=1024, n_heads=16, n_kv_heads=None, clip_qkv=None, n_layers=12, mlp_ratio=4, mlp_hidden_size=4096, activation_type='gelu', block_type='sequential', block_group_size=1, alibi=False, alibi_bias_max=8.0, rope=True, rope_full_precision=True, flash_attention=False, attention_dropout=0.0, multi_query_attention=False, attention_layer_norm=True, residual_dropout=0.0, embedding_dropout=0.0, layer_norm_type='default', layer_norm_with_affine=True, attention_layer_norm_with_affine=True, max_sequence_length=512, include_bias=False, bias_for_layer_norm=False, scale_logits=False, vocab_size=50280, embedding_size=50304, weight_tying=False, eos_token_id=0, pad_token_id=1, init_device='meta', init_fn='mitchell', init_std=0.02, init_cutoff_factor=None, precision='amp_bf16'), optimizer=OptimizerConfig(name='adamw', learning_rate=0.001, weight_decay=0.0, betas=(0.9, 0.95), eps=1e-15, no_decay_norm_and_bias=None, decay_norm_and_bias=False, decay_embeddings=False, metrics_log_interval=100), scheduler=SchedulerConfig(name='cosine_with_warmup', units='steps', t_warmup=1000, t_max=None, alpha_f=0.1, grad_clip_warmup_steps=None, grad_clip_warmup_factor=None, warmup_min_lr=None), data=DataConfig(paths='c4', datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=16, drop_last=True, pin_memory=True, prefetch_factor=16, persistent_workers=True, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), restore_dataloader=False, fast_forward_batches=None, evaluators=[EvaluatorConfig(label='books', type='lm', data=DataConfig(paths=None, datasets={'books_val': 'books-val'}, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=True, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='piqa_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='openbook_qa_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='hellaswag_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='winogrande_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='arc_easy_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='arc_challenge_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='boolq_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='sciq_train', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=None, sft_use_label=False, sft=False), EvaluatorConfig(label='piqa_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='openbook_qa_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='hellaswag_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='winogrande_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='arc_easy_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='arc_challenge_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='boolq_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False), EvaluatorConfig(label='sciq_test', type='downstream', data=DataConfig(paths=None, datasets=None, label_mask_paths=None, pad_direction='right', generate_attention_mask=False, num_workers=0, drop_last=False, pin_memory=False, prefetch_factor=None, persistent_workers=False, timeout=0, seed=None, memmap_dtype='uint16', extra_data_paths=None, extra_data_key=None, load_extra_data_to_ram=False, index_path=None), device_eval_batch_size=None, subset_num_batches=1000, sft_use_label=False, sft=False)], eval_interval=2000, tokenizer=TokenizerConfig(identifier='allenai/eleuther-ai-gpt-neox-20b-pii-special', truncate_direction='right'), save_folder='ckpts/57680871_1/', remote_save_folder=None, canceled_check_interval=50, save_interval=5000, save_interval_unsharded=100000, save_interval_ephemeral=None, save_num_checkpoints_to_keep=1, save_num_unsharded_checkpoints_to_keep=1, save_overwrite=True, force_save_unsharded=False, no_pre_train_checkpoint=False, load_path='prior', load_path_sharded_checkpointer=None, reset_optimizer_state=True, reset_trainer_state=True, sharded_checkpointer='torch_legacy', new_style_checkpoints=None, max_duration=192000, global_train_batch_size=256, device_train_batch_size=256, device_train_microbatch_size=256, device_eval_batch_size=64, eval_subset_num_batches=100, eval_on_load=False, device_train_grad_accum=1, max_grad_norm=1.0, max_grad_norm_ratio=None, precision='amp_bf16', wandb=None, speed_monitor=SpeedMonitorConfig(window_size=1, gpu_flops_available=None), console_log_interval=10, gen1_gc_interval=1, compile=CompilerConfig(mode='default', fullgraph=False, backend='inductor'), fsdp=FSDPConfig(use_orig_params=True, sharding_strategy=<ShardingStrategy.FULL_SHARD: 1>, wrapping_strategy=None, precision='mixed', hybrid_sharding_num_model_replicas=None), softmax_auxiliary_loss=True, time_limit=None, extra_steps_after_cancel=10, early_stopping_factor=None, save_data_indices=True, python_profiling=False, torch_profiling=False, stop_at=None, stop_after=None, activation_checkpointing=None, fused_loss=None)
holygpu8a11103:0 out: 2024-11-14 21:05:36.439	holygpu8a11103.rc.fas.harvard.edu:0	train:169	INFO	Saving config to ckpts/57680871_1/config.yaml
holygpu8a11103:0 out: 2024-11-14 21:05:47.851	holygpu8a11103.rc.fas.harvard.edu:0	olmo.data.iterable_dataset:76	INFO	Saving global data order indices...
holygpu8a11103:0 out: 2024-11-14 21:05:53.940	holygpu8a11103.rc.fas.harvard.edu:0	olmo.data.iterable_dataset:85	INFO	Global data order indices saved to 'ckpts/57680871_1/train_data/global_indices.npy'
holygpu8a11103:0 out: 2024-11-14 21:05:53.942	holygpu8a11103.rc.fas.harvard.edu:0	train:210	INFO	Built train dataloader for dataset of size 48564572
holygpu8a11103:0 out: 2024-11-14 21:05:53.942	holygpu8a11103.rc.fas.harvard.edu:0	train:47	INFO	Building model...
holygpu8a11103:0 out: 2024-11-14 21:05:56.339	holygpu8a11103.rc.fas.harvard.edu:0	train:49	INFO	Total number of parameters: 254,067,712
holygpu8a11103:0 out: 2024-11-14 21:05:56.340	holygpu8a11103.rc.fas.harvard.edu:0	train:50	INFO	Number of non-embedding parameters: 151,045,120
holygpu8a11103:0 out: 2024-11-14 21:05:56.354	holygpu8a11103.rc.fas.harvard.edu:0	train:51	INFO	Peak GPU Memory (MB) before FSDP: 0
holygpu8a11103:0 out: 2024-11-14 21:05:56.354	holygpu8a11103.rc.fas.harvard.edu:0	train:56	INFO	Wrapping model with FDSP...
holygpu8a11103:0 out: 2024-11-14 21:05:56.483	holygpu8a11103.rc.fas.harvard.edu:0	olmo.model:1021	INFO	Initializing model parameters...
holygpu8a11103:0 out: 2024-11-14 21:05:59.426	holygpu8a11103.rc.fas.harvard.edu:0	train:109	INFO	Peak GPU Memory (MB) after FSDP: 2033
holygpu8a11103:0 out: 2024-11-14 21:05:59.426	holygpu8a11103.rc.fas.harvard.edu:0	train:110	INFO	Model:
holygpu8a11103:0 out: 2024-11-14 21:05:59.426	holygpu8a11103.rc.fas.harvard.edu:0	train:111	INFO	FullyShardedDataParallel(
holygpu8a11103:0 out:   (_fsdp_wrapped_module): OLMo(
holygpu8a11103:0 out:     (transformer): ModuleDict(
holygpu8a11103:0 out:       (wte): Embedding(50304, 1024)
holygpu8a11103:0 out:       (emb_drop): Dropout(p=0.0, inplace=False)
holygpu8a11103:0 out:       (ln_f): LayerNorm()
holygpu8a11103:0 out:       (blocks): ModuleList(
holygpu8a11103:0 out:         (0-11): 12 x OLMoSequentialBlock(
holygpu8a11103:0 out:           (dropout): Dropout(p=0.0, inplace=False)
holygpu8a11103:0 out:           (k_norm): LayerNorm()
holygpu8a11103:0 out:           (q_norm): LayerNorm()
holygpu8a11103:0 out:           (act): GELU(approximate='none')
holygpu8a11103:0 out:           (attn_out): Linear(in_features=1024, out_features=1024, bias=False)
holygpu8a11103:0 out:           (ff_out): Linear(in_features=4096, out_features=1024, bias=False)
holygpu8a11103:0 out:           (rotary_emb): RotaryEmbedding()
holygpu8a11103:0 out:           (attn_norm): LayerNorm()
holygpu8a11103:0 out:           (ff_norm): LayerNorm()
holygpu8a11103:0 out:           (att_proj): Linear(in_features=1024, out_features=3072, bias=False)
holygpu8a11103:0 out:           (ff_proj): Linear(in_features=1024, out_features=4096, bias=False)
holygpu8a11103:0 out:         )
holygpu8a11103:0 out:       )
holygpu8a11103:0 out:       (ff_out_last): Linear(in_features=1024, out_features=50304, bias=False)
holygpu8a11103:0 out:     )
holygpu8a11103:0 out:   )
holygpu8a11103:0 out: )
holygpu8a11103:0 out: 2024-11-14 21:05:59.428	holygpu8a11103.rc.fas.harvard.edu:0	olmo.optim:721	INFO	Constructing optimizer with 2 param groups
holygpu8a11103:0 out: 2024-11-14 21:05:59.473	holygpu8a11103.rc.fas.harvard.edu:0	train:272	INFO	Loading checkpoint from /n/home11/cbrownpinilla/color_filter/color-filter-olmo/ckpts/56504321_1/step815-unsharded/...
holygpu8a11103:0 out: 2024-11-14 21:06:23.320	holygpu8a11103.rc.fas.harvard.edu:0	train:279	INFO	Checkpoint successfully loaded
holygpu8a11103:0 out: 2024-11-14 21:06:28.177	holygpu8a11103.rc.fas.harvard.edu:0	train:307	INFO	Scoring model...
holygpu8a11103:0 out: 2024-11-14 21:06:28.972	holygpu8a11103.rc.fas.harvard.edu:0	olmo.train:843	INFO	Pre-train system metrics
holygpu8a11103:0 out:     System/Peak GPU Memory (MB)=2,033
holygpu8a11103:0 out: 2024-11-14 21:06:29.152	holygpu8a11103.rc.fas.harvard.edu:0	olmo.util:160	CRITICAL	Uncaught FileNotFoundError: [Errno 2] No such file or directory: 'ckpts/57680871_1//<generator object Scorer.score_model.<locals>.<genexpr> at 0x1540c1968ac0>/chunk_scores.jsonl'
holygpu8a11103:0 out: Traceback (most recent call last):
holygpu8a11103:0 out:   File "/n/home11/cbrownpinilla/color_filter/color-filter-olmo/scripts/train.py", line 338, in <module>
holygpu8a11103:0 out:     main(cfg)
holygpu8a11103:0 out:   File "/n/home11/cbrownpinilla/color_filter/color-filter-olmo/scripts/train.py", line 309, in main
holygpu8a11103:0 out:     trainer.score_model()
holygpu8a11103:0 out:   File "/n/home11/cbrownpinilla/color_filter/color-filter-olmo/olmo/score.py", line 89, in score_model
holygpu8a11103:0 out:     with open(f'{self.cfg.save_folder}/{model}/chunk_scores.jsonl', "a") as json_out:
holygpu8a11103:0 out: FileNotFoundError: [Errno 2] No such file or directory: 'ckpts/57680871_1//<generator object Scorer.score_model.<locals>.<genexpr> at 0x1540c1968ac0>/chunk_scores.jsonl'
srun: error: holygpu8a11103: task 0: Exited with exit code 1
srun: Terminating StepId=57680871.0
